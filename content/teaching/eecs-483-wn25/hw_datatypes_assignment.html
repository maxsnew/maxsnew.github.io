<!doctype HTML>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Assignment 4: Datatypes</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="screen.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script>$.noConflict();</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ["$","$"], ["\\(","\\)"] ],
    displayMath: [ ["$$","$$"],
                   ["\\[","\\]"],
                   ["\\begin{equation}","\\end{equation}"],
                   ["\\begin{equation*}","\\end{equation*}"] ],
    processEscapes: true
  },
  "HTML-CSS": {
    availableFonts: ["Asana-Math", "STIX", "TeX"],
    webFont: "Asana-Math",
    preferredFont: "Asana-Math",
    imageFont: null,
    mtexFontInherit: true
  }
});</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="codemirror.js"></script><script src="runmode.js"></script><script src="scheme.js"></script><script src="mllike.js"></script><script src="rust.js"></script><script src="haskell.js"></script><script src="clike.js"></script><script src="javascript.js"></script><script src="asm86.js"></script><script src="asm64.js"></script><script src="shell.js"></script><script src="python.js"></script><script src="makefile-mode.js"></script><script src="setup-cm.js"></script></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x"><span class="AssignmentNum">Assignment 4:</span> Datatypes</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.The_.Diamondback_.Language%29" class="tocviewlink" data-pltdoc="x">The Diamondback Language</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.S.S.A_.Extensions%29" class="tocviewlink" data-pltdoc="x">SSA Extensions</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Runtime_.System%29" class="tocviewlink" data-pltdoc="x">Runtime System</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Starter_.Code_and_.Deliverables%29" class="tocviewlink" data-pltdoc="x">Starter Code and Deliverables</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._%29" class="tocsubseclink" data-pltdoc="x"><span class="AssignmentNum">Assignment 4:</span> Datatypes</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.The_.Diamondback_.Language%29" class="tocsubseclink" data-pltdoc="x">The Diamondback Language</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Concrete_.Syntax%29" class="tocsubseclink" data-pltdoc="x">Concrete Syntax</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.Semantics%29" class="tocsubseclink" data-pltdoc="x">Semantics</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Runtime_.Representation%29" class="tocsubseclink" data-pltdoc="x">Runtime Representation</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.S.S.A_.Extensions%29" class="tocsubseclink" data-pltdoc="x">SSA Extensions</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Semantics%29" class="tocsubseclink" data-pltdoc="x">Semantics</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Code_generation%29" class="tocsubseclink" data-pltdoc="x">Code generation</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Runtime_.System%29" class="tocsubseclink" data-pltdoc="x">Runtime System</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Starter_.Code_and_.Deliverables%29" class="tocsubseclink" data-pltdoc="x">Starter Code and Deliverables</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">8.15</span></div><h2 class="heading"><a name="(part._)"></a><span class="AssignmentNum">Assignment 4:</span> Datatypes<span class="button-group"><a href="#(part._)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h2><p><h4 class="due">Due: Fri 04/04 at 11:59pm</h4></p><p><p class="git-clone"><code><span class="kw">git clone </span><input onclick="this.select();" readonly="readonly" value="https://gitlab.eecs.umich.edu/483-wn25/datatypes"/></code></p></p><p>In this assignment, we extend our Snake language with support for dynamic typing and heap-allocated arrays.</p><h3 class="heading">1<tt>&nbsp;</tt><a name="(part._.The_.Diamondback_.Language)"></a>The Diamondback Language<span class="button-group"><a href="#(part._.The_.Diamondback_.Language)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><h4 class="heading">1.1<tt>&nbsp;</tt><a name="(part._.Concrete_.Syntax)"></a>Concrete Syntax<span class="button-group"><a href="#(part._.Concrete_.Syntax)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><blockquote class="SCodeFlow" style="white-space: pre;"><p><a name="(elem._(bnf-prod._(.Diamondback._expr)))"></a><span class="bnf-rule">&#8249;expr&#8250;</span><span class="bnf-meta">:</span> <span class="bnf-lit bnf-unknown">...</span>
          <span class="bnf-meta"> | </span><span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._array%29%29%29" data-pltdoc="x">&#8249;array&#8250;</a></span>
          <span class="bnf-meta"> | </span><span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">[</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">]</span>
          <span class="bnf-meta"> | </span><span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">[</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">]</span> <span class="bnf-lit">:=</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span>
          <span class="bnf-meta"> | </span><span class="bnf-lit">newArray</span> <span class="bnf-lit">(</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">)</span>
          <span class="bnf-meta"> | </span><span class="bnf-lit">length</span> <span class="bnf-lit">(</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">)</span>
          <span class="bnf-meta"> | </span><span class="bnf-lit">isBool</span> <span class="bnf-lit">(</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">)</span>
          <span class="bnf-meta"> | </span><span class="bnf-lit">isInt</span> <span class="bnf-lit">(</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">)</span>
          <span class="bnf-meta"> | </span><span class="bnf-lit">isArray</span> <span class="bnf-lit">(</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">)</span>
<a name="(elem._(bnf-prod._(.Diamondback._exprs)))"></a><span class="bnf-rule">&#8249;exprs&#8250;</span><span class="bnf-meta">:</span> 
            <span class="bnf-meta"> | </span><span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span>
            <span class="bnf-meta"> | </span><span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._expr%29%29%29" data-pltdoc="x">&#8249;expr&#8250;</a></span> <span class="bnf-lit">,</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._exprs%29%29%29" data-pltdoc="x">&#8249;exprs&#8250;</a></span>
<a name="(elem._(bnf-prod._(.Diamondback._array)))"></a><span class="bnf-rule">&#8249;array&#8250;</span><span class="bnf-meta">:</span> 
            <span class="bnf-meta"> | </span><span class="bnf-lit">[</span> <span class="bnf-lit">]</span>
            <span class="bnf-meta"> | </span><span class="bnf-lit">[</span> <span class=""><a href="#%28elem._%28bnf-prod._%28.Diamondback._exprs%29%29%29" data-pltdoc="x">&#8249;exprs&#8250;</a></span> <span class="bnf-lit">]</span></p></blockquote><h4 class="heading">1.2<tt>&nbsp;</tt><a name="(part._.Semantics)"></a>Semantics<span class="button-group"><a href="#(part._.Semantics)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Runtime values in Diamondback are either 63-bit signed integers, booleans <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">true</code></span> or <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">false</code></span> or a mutable array of Diamondback values.</p><p><p>Most operations in Diamondback have strict dynamic type checking, and raise runtime errors if they are applied to incorrect values or overflow:
</p><ul><li><p>If an arithmetic operation <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">+,-,*</code></span> receives any input that is not an integer, it raises the error message "expected a number, got v". If the arithmetic operation overflows, it should raise the error message "arithmetic operation overflowed"</p></li><li><p>If a comparison operation <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">&lt;,&lt;=,&gt;,&gt;=</code></span> receives an input <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">v</code></span> that is not an integer, it raises the error message "expected a number, got v".</p></li><li><p>If a boolean operation <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">&amp;&amp;,||, !</code></span> receives an input <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">v</code></span> that is not a boolean, it raises an error "expected a boolean, got v".</p></li><li><p>If an if statement is run on a value <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">v</code></span> that is not a boolean, it raises an error "expected a boolean, got v".</p></li><li><p>If <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">newArray</code></span> is called on a non-integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">v</code></span> it raises an "expected a number got v" error. If the input is a negative integer it raises an error "length v is negative".</p></li><li><p>In evaluating <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">length(e1)</code></span>,<span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">e1[e2]</code></span> or <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">e1[e2] := e3</code></span> if after evaluating all sub-expressions, <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">e1</code></span> is not an array, raise the error "expected an array got v". After checking this, check that <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">e2</code></span> is an integer and a valid index. If it is not an integer, raise the error "expected a number got v" and if it is an integer but not in the range of the array, raise the error "index n out of bounds"</p></li></ul></p><p>The equality and inequality operations implement <span class="emph">physical equality</span> of values, so two array values are only equal if they are the same object in memory, regardless of if they contain the same values.
So for instance, <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">x == x</code></span> always returns true, but <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">[0] == [0]</code></span> returns false because each of the two arrays is newly allocated. Values of different type are always unequal, e.g., <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">0 != false</code></span>.</p><p>The operations <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">isInt,isBool,isArray</code></span> return true when the value is of that type and false otherwise.</p><p><p>When displaying the final result of a Diamondback program, or executing the <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">print</code></span> function, the value should be printed to stdout as follows:
</p><ul><li><p>Integers should be displayed as signed integers</p></li><li><p><span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">true</code></span> and <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">false</code></span> should be displayed as such</p></li><li><p>An array <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">[v1, ...]</code></span> should be printed as a square bracket, followed by the values printed out, with a ", " separating the values, and ending in a close bracket. The only exception to this is for <span class="emph">circular</span> array values such as an array whose only element is itself. This can be constructed as <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">let a = [0] in let _ = a[0] := a in a</code></span>. Whenever a circularity is reached, rather than printing infinitely, the value should be printed as "&lt;loop&gt;". So the circular array should be printed as "[&lt;loop&gt;]".</p></li></ul></p><p>There are two primitives for creating new array values. The operation <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">newArray(e)</code></span> takes a non-negative integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">e</code></span> as input and creates an array of that given length, with all the elements initialized to <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">0</code></span>. Array literals <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">[e1,e2,...]</code></span> are parsed as <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">Prim(MakeArray,[e1,e2,...])</code></span> which creates an array with the given arguments as initial values.</p><p>Use "ArrayGet" and "ArraySet" to read and modify the elements in an array. <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">a[i]</code></span> takes an array <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">a</code></span> and a zero-indexed integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">i</code></span> and outputs the element at index <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">i</code></span> in the array. The expression <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">a[i] := b</code></span> takes three arguments: an array <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">a</code></span>, a zero-indexed integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">i</code></span>, and an arbitrary expression <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">b</code></span> after modifying the element at index <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">i</code></span> in the array to be <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">b</code></span>, the whole expression outputs <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">b</code></span>.</p><p>Finally, the <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">length</code></span> operation takes an array and outputs its length.</p><h4 class="heading">1.3<tt>&nbsp;</tt><a name="(part._.Runtime_.Representation)"></a>Runtime Representation<span class="button-group"><a href="#(part._.Runtime_.Representation)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The runtime representation for values is as follows:</p><ul><li><p>A 63-bit integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">n</code></span> is represented as the 64-bit integer <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">2 * n</code></span></p></li><li><p><span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">true</code></span> has the runtime representation <span title="X64 Assembly" class="sourceCode"><code data-lang="text/x-asm64" class="sourceCode">0b101</code></span> and <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">false</code></span> is represented as <span title="X64 Assembly" class="sourceCode"><code data-lang="text/x-asm64" class="sourceCode">0b001</code></span></p></li><li><p>An array <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">a</code></span> is stored as a pointer with the bottom two bits overwritten to <span title="X64 Assembly" class="sourceCode"><code data-lang="text/x-asm64" class="sourceCode">0b11</code></span>. The pointer points to an object on the heap consisting of a length and then the values in the array sequentially after it (i.e., at higher addresses).</p></li></ul><h3 class="heading">2<tt>&nbsp;</tt><a name="(part._.S.S.A_.Extensions)"></a>SSA Extensions<span class="button-group"><a href="#(part._.S.S.A_.Extensions)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>Unlike Diamondback, SSA values are 64-bit signed integers. In the translation from Diamondback to SSA, diamondback values must be explicitly tagged and encoded to their correct runtime representation. All primitive operators in SSA expect inputs and outputs to be "untagged" as before, and manual tagging and untagging should be performed when lowering AST operators to SSA operators. For example:</p><p>Our SSA IR is extended with assertions for error checking as well as array primitives:</p><ul><li><p>"AssertType" takes a desired type and a tagged argument</p></li><li><p>"AssertLength" takes an untagged (but signed) integer argument</p></li><li><p>"AssertInBounds" takes two untagged integer arguments, where the first one is the bound</p></li><li><p>"Store" takes an untagged address, an untagged integer offset, and a value that is either tagged or untagged</p></li><li><p>Operation "Load" takes an untagged address and an untagged offset</p></li><li><p>Operation "AllocateArray" takes an untagged integer length.</p></li></ul><p>The other extensions to SSA are 4 shift operations, arithmetic/logical left/right shift. These operations are introduced to closely ressemble their corresponding assembly instructions. The shift offset must be an unsigned 8-bit integer constant, which is the reason why these shift operations are introduced as "ssa::Prim1", because they only require one input argument. The "IntToBool" operation is removed in favor of dynamic type checking and explicit tagging.</p><h4 class="heading">2.1<tt>&nbsp;</tt><a name="(part._.Semantics)"></a>Semantics<span class="button-group"><a href="#(part._.Semantics)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>The primitive operations in SSA should have the same semantics as their assembly counterpart. The arithmetic operations <span title="SSA" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">+</code></span>,<span title="SSA" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">-</code></span> and <span title="SSA" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">*</code></span> raise an error message "arithmetic operation overflowed" if the operation overflows the 64-bit representation.</p><p>The "AssertType" instruction checks if the tagged argument has the same tag as the desired type. When the runtime argument doesn&rsquo;t keep up to the assertion, the instruction should produce the error message "expected a &lt;type&gt;, got &lt;value&gt;", where "&lt;type&gt;" is either "number", "boolean", or "array", and "&lt;value&gt;" is the Diamondback representation of the argument (e.g. <span title="Diamondback" class="sourceCode"><code data-lang="text/x-snake" class="sourceCode">true</code></span> if the input is <span title="X64 Assembly" class="sourceCode"><code data-lang="text/x-asm64" class="sourceCode">5</code></span>).</p><p>The "AssertLength" instruction checks if the untagged signed integer is non-negative at runtime. If not, it should produce the error message "length &lt;n&gt; is negative", where "&lt;n&gt;" is the length.</p><p>The "AssertInBounds" instruction checks if the untagged signed index is in the range [0, bound). If not, it should produce the error message "index &lt;n&gt; out of bounds", where "&lt;n&gt;" is the index.</p><p>The "Store" and "Load" should store or load element located at (address + offset * 8).</p><p>Finally, "AllocateArray" calls "snake_new_array" in stub.rs file. The input is an untagged integer length, and the output is an untagged address pointing to the allocated array.</p><h4 class="heading">2.2<tt>&nbsp;</tt><a name="(part._.Code_generation)"></a>Code generation<span class="button-group"><a href="#(part._.Code_generation)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h4><p>Code generation for most existing operators is unchanged from previous assignments. An exception is that arithmetic operations should check for overflow, which can be detected by the overflow condition code <span title="X64 Assembly" class="sourceCode"><code data-lang="text/x-asm64" class="sourceCode">o</code></span>.</p><p>Assertions are compiled to comparison and a conditional jump to the error labels as demonstrated in the lectures. At the beginning of your code generation, you should emit labeled blocks that call call "snake_error" with the error code set as the first argument. For those errors that require a second argument, you should correctly set it up as well before jumping to the error label.</p><h3 class="heading">3<tt>&nbsp;</tt><a name="(part._.Runtime_.System)"></a>Runtime System<span class="button-group"><a href="#(part._.Runtime_.System)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>The runtime system has been split into three files: <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">runtime/common.rs</code></span> includes some basic definitions and utilities. <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">runtime/extensions.rs</code></span> is a file containing the error handling as well as printing for snake values, which you must implement. <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">runtime/stub.rs</code></span> has been extended to initialize the Snake heap, and provides the function <span title="Rust" class="sourceCode"><code data-lang="text/x-rustsrc" class="sourceCode">snake_new_array</code></span> to allocate new array values. Additionally, it modifies the call into <span title="Rust" class="sourceCode"><code data-lang="text/x-rustsrc" class="sourceCode">entry</code></span> to consist of an array value of the command line arguments.</p><p>You need to complete the <span title="Rust" class="sourceCode"><code data-lang="text/x-rustsrc" class="sourceCode">sprint_snake_value</code></span> function in <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">runtime/extensions.rs</code></span> to support printing Diamondback values correctly.</p><h3 class="heading">4<tt>&nbsp;</tt><a name="(part._.Starter_.Code_and_.Deliverables)"></a>Starter Code and Deliverables<span class="button-group"><a href="#(part._.Starter_.Code_and_.Deliverables)" class="heading-anchor" title="Link to here">ðŸ”—</a><span style="visibility: hidden"> </span></span></h3><p>This assignment&rsquo;s starter code includes a full implemtation of the frontend, and much of the scaffolding of the middle end.</p><p><p>For this assignment you will submit your updated versions of three
files:
</p><ul><li><p>src/frontend.rs</p></li><li><p>src/middle_end.rs</p></li><li><p>src/backend.rs</p></li><li><p>runtime/extensions.rs</p></li></ul></p><p>You don&rsquo;t have to update <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">src/frontend.rs</code></span> but if you prefer to you are allowed to do so.</p><p>These are the only files that you can change in your submission, your
code will be linked with reference versions of the other files.</p><p>We&rsquo;ve included a script <span title="Shell" class="sourceCode"><code data-lang="text/x-sh" class="sourceCode">mk_submission.sh</code></span> in the starter code
repo that should make zip file with just those three files and your
testing files that you should upload to gradescope. The testing files
are included for us to get some idea of how students are testing their
code, they are not graded.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>